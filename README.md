## License
Source-available, non-commercial: **MIT License**.  
See `LICENSE` for full text.  
For commercial use or exceptions, please contact <wsp@a.kogtev.ru>.

# Donatimer

Вы клоун который выступает на потеху публике на популярныйх стриминговых платформах? Тогда наверное вы либо хотели, либо уже проводили Донатон, это мероприятние когда вы стримите пока идет обратный таймер, но сумма денежных донатов повышает таймер в зависимсоти от суммы пожертвования. Так вот самому высчитывать и прибавлять таймер руками, очень неудобно, так что я решил сделать, для всех бедолаг вроде тебя, маленькую программульку, которая будет делать автоматически! Все что тебе надо это запустить .exe файл, который ты можешь скачать в разделе Releases тут на Github, связать свой DA и прогу на странице /auth в приложении, после чего выставить какие тебе надо настройки на странице приложения /config. Сам таймер ты можешь добавить в OBS как BrowserSource, тебе лишь надо указать в нем адрес `http://localhost:8000` и таймер начнет отображаться в виджете, да все так просто, что даже стример разберется!

Мини-приложение на **FastAPI**: веб-таймер обратного отсчёта (формат `HH:MM:SS`) с панелью управления, WebSocket-обновлениями и интеграцией **DonationAlerts** (OAuth + Centrifugo).  
Поддерживает: старт/стоп/сброс (с подтверждением), установку времени, настраиваемое соотношение «₽ → сек» (в т.ч. дробное, например `4.5`), выбор цвета текста таймера (чёрный/белый)

## Использование
Качаете wsp-donaton-timer.exe последней версии с этой страницы [https://github.com/AKogtev/wsp-donaton-timer/releases ](https://github.com/AKogtev/wsp-donaton-timer/releases)
После запуска вам в браузере будут доступны следующие страницы:
- `http://localhost:8000/` - только таймер на прозрачном фоне (текст белый/чёрный — управляется из панели)
- `http://localhost:8000/config` - Панель конфигурации таймера, тут можно выставить время, запустить, остановить, таймер. Настроить цвет таймера (Либо белый, либо черный). Посмотреть Логи действий, выставить коэффициент времени к сумме доната и так далее
- `http://localhost:8000/auth` - страница на который вы связываете свой аккаунт DonationAlerts и таймер

## Подключаем DonationAlerts к Таймеру
1. Зхаодим на сайт **DonationAlerts**, там нажимаем на свою аватарку в правом верхнем углу и переходим в "**Настройки Аккаунта**"
2. На странице настроек, переходим в самый правый раздел "**Приложения**" и нажимаем на кликабельную ссылку, которая должна перекинуть нас на страницу `https://www.donationalerts.com/application/clients`
3. Нажимаем создать новое приложение, в поле "Имя приложения" пишем **wsp-donaton-timer**, в поле "URL перенаправления" обязатльно вставляем `http://localhost:8000/callback` и нажимаем "Создать". По итогу видим форму, где нам показываю ID приложения и
Ключ API нашего приложения, не закрывая страницу переходим к следующему шагу
4. Далее переходим на страницу приложения `http://localhost:8000/auth` и в поле "**OAuth Client ID**" вводим наш **ID приложения**, а в поле "**OAuth Client Secret**" вставляем **Ключ API** и нажимаем "Начать авторизацю"
5. После этого нас перекинет на страницу авторизации **DonationAlerts**, которая может показать _"Page Expired"_ или типо того, это нормально, просто надо обновите страницу
6. Теперь, нас должно перекинуть обратно на страницу настроек, где в поле **OAuth Access Token** автоматическиподставлен наш токен, нам нужно просто нажать "**Save Toke**", после чего в логе должны появится сообщения об успешом подключении

## Структура проекта
```
donaton/
├─ app/
│  ├─ core/         # config/state/
│  ├─ routes/       # роуты страниц и сокетов
│  ├─ services/     # таймер, DonationAlerts, менеджеры
│  ├─ static/       # style.css, js/…
│  └─ templates/    # Jinja2 (base.html, config.html, auth.html)
├─ run_app.py       # Точка входа для dev/pyinstaller
├─ requirements.txt # Зависимости которые устанавливаются при сборке
└─ .env             # (опционально) переменные окружения рядом с exe/репо
```

## Сборка проекта
Если вы параноидальный шизофреник и думаете, что в релизный .exe я упаковал 80 троянов и 30 бэкдоров, можете изучить исходный код проекта и собрать все это дело из исходников.
Собираем в **один исполняемый файл** без установки пакетов в систему, я билдил на Винде с помощью cmd. Находясь в директории проекта выполняем команды:

Создаем виртуальную среду, чтобы не засорять систему разными пакетами:
 ```
py -m venv .venv
```

Устанавливаем pip
```
.\.venv\Scripts\python -m pip install --upgrade pip
```

Устанавливаем зависимости:
```
.\.venv\Scripts\pip install -r requirements.txt
```

Запускаем сборку .exe файла:
```
.\.venv\Scripts\pyinstaller --noconfirm --onefile --name wsp-donaton-timer --paths . --hidden-import dotenv --add-data "app\templates;app\templates" --add-data "app\static;app\static" run_app.py
```

На выходе получаем готовый .exe файл в директории dist, то есть `dist\wsp-donaton-timer.exe`

